# RedInsight 更新日志

## [2025-01-27] 重大功能更新：长尾关键词提取与深度分析增强

### 🆕 新增功能

#### 1. 长尾关键词提取功能
- **大模型提取长尾关键词**：在深度分析流程中，使用大模型从Reddit帖子中提取长尾关键词（多词短语）
- **混合提取策略**：
  - TF-IDF 提取高频单词
  - 大模型提取长尾关键词短语（如 "iPhone battery replacement"、"home renovation cost"）
  - 自动去重和频率统计
- **数据库存储**：
  - 为 `structured_extractions` 表添加 `long_tail_keywords` 字段
  - 在 `keyword_statistics` 表中新增 `long_tail` 类别存储
- **界面展示**：
  - 在深度分析结果页面显示长尾关键词
  - 支持下载包含长尾关键词的统计报告

#### 2. 关键词统计报告导出
- **自动化导出**：深度分析完成后自动导出关键词统计报告到 `output/` 目录
- **报告内容**：
  - 前50个高频关键词（TF-IDF提取）
  - 主要主题统计
  - 痛点统计
  - 用户需求统计
  - 长尾关键词统计（大模型提取）
- **文件格式**：纯文本文件，易于阅读和分析

### 🔧 技术改进

#### 1. 数据库架构优化
- 添加 `long_tail_keywords` 列到 `structured_extractions` 表
- 更新 ORM 模型以支持新字段
- 保持向后兼容性

#### 2. 深度分析流程增强
- **六阶段分析流程**：
  1. 结构化抽取（含长尾关键词提取）
  2. 文本向量化
  3. 智能聚类
  4. 业务洞察生成
  5. 关键词提取和统计（TF-IDF + 长尾词）
  6. 报告导出
- **提示词优化**：在结构化抽取提示词中明确要求提取长尾关键词

#### 3. 依赖管理修复
- 解决 PyTorch 和 sentence-transformers 依赖冲突
- 修复 `anthropic` 模块导入错误（支持可选导入）
- 稳定依赖版本配置

### 🐛 问题修复

1. **长尾关键词未显示**：
   - 原因：旧版本提示词未包含长尾关键词字段
   - 修复：更新提示词示例，明确要求提取长尾关键词

2. **关键词统计未导出**：
   - 原因：`_export_results` 方法只导出业务洞察，未包含关键词统计
   - 修复：新增 `_export_keywords_report()` 方法，自动导出完整的关键词统计报告

3. **数据库架构不一致**：
   - 原因：代码已更新但数据库表结构未迁移
   - 修复：提供数据库迁移脚本，添加 `long_tail_keywords` 列

### 📊 功能对比

| 功能 | 之前 | 现在 |
|------|------|------|
| 关键词提取 | TF-IDF 单词 | TF-IDF + 长尾词 |
| 报告导出 | 业务洞察（JSON/TXT） | 业务洞察 + 关键词统计 |
| 长尾词提取 | ❌ | ✅ 大模型提取 |
| 界面展示 | 只显示高频词 | 显示高频词+长尾词 |

### 🎯 用户体验改进

1. **更丰富的关键词洞察**：
   - 不仅了解高频单词，还能获取长尾搜索意图
   - 示例：从 "renovation" → "home renovation cost"
   
2. **完整的分析报告**：
   - 一次性获取所有分析结果（业务洞察 + 关键词统计）
   - 报告中包含长尾关键词的完整列表

3. **自动化处理**：
   - 深度分析完成后自动提取和统计关键词
   - 自动导出到文件系统，无需手动操作

### 🔄 工作流程

**之前的流程**：
```
Reddit数据 → 结构化抽取 → 向量化 → 聚类 → 洞察生成 → 完成
```

**现在的流程**：
```
Reddit数据 → 结构化抽取（含长尾词） → 向量化 → 聚类 → 洞察生成 
  → 关键词提取（TF-IDF + 长尾词） → 统计 → 导出完整报告 → 完成
```

### 📝 开发者注意事项

1. **数据库迁移**：
   - 首次运行需要执行：`python add_longtail_column.py`（已内置）
   
2. **向后兼容**：
   - 旧的分析数据不包含长尾关键词是正常的
   - 需要重新运行深度分析才能获取长尾关键词

3. **API成本**：
   - 长尾关键词提取使用大模型，会增加API调用成本
   - 每篇文章需要一次完整的结构化抽取调用

### 🚀 下一步计划

1. 优化长尾关键词提取的准确性
2. 增加关键词分类（产品、服务、问题等）
3. 提供关键词趋势分析
4. 支持自定义长尾关键词提取规则

---

## 之前的更新

### [2025-01-26] 深度分析功能上线
- 实现完整的深度分析流程
- 添加结构化抽取、向量化、聚类、洞察生成功能
- 优化用户界面和用户体验

### 更早的版本
- 初始项目建立
- Reddit 数据抓取功能
- 基础数据分析功能
